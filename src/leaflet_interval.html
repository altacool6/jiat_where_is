<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ë™ì  ì•„ì´ì½˜ ë§ˆì»¤ ì˜ˆì œ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { margin:0; padding:0; }
    #map { width: 100vh; height: 50vh; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // ì§€ë„ ì´ˆê¸°í™”
    var map = L.map('map').setView([37.5665, 126.9780], 15);

    // OpenStreetMap íƒ€ì¼ ì¶”ê°€
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // ì»¤ìŠ¤í…€ ì•„ì´ì½˜ ì •ì˜
    var movingIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/685/685352.png',
      iconSize: [40, 40],
      iconAnchor: [20, 40]
    });

    var stoppedIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/484/484662.png',
      iconSize: [40, 40],
      iconAnchor: [20, 40]
    });

    // ìµœì´ˆ ë§ˆì»¤ ìƒì„±
    var currentLat = 37.5665;
    var currentLon = 126.9780;
    var marker = L.marker([currentLat, currentLon], {icon: movingIcon}).addTo(map);

    // ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜ (ì£¼í–‰/ì •ì§€ ëœë¤)
    function updateVehicle() {
      var fatchedData = fetch('http://172.168.15.220:5000/cur_value?topic=v2i-pvd', { mode: 'no-cors'});  // Flaskì—ì„œ ì œê³µí•˜ëŠ” ìœ„ì¹˜ API í˜¸ì¶œ
      
      var fatchedJson = fatchedData.then(response => response.json());

      fatchedJson.then(fatchedJson => {
        const lat = fatchedJson.lat;
        const lon = fatchedJson._long;
        //console.log("í˜„ì¬ì¢Œí‘œ : " lat, lon)

        //var deltaLat = (Math.random() - 0.5) * 0.0008;
        //var deltaLon = (Math.random() - 0.5) * 0.001;

        // ë§ˆì»¤ ì´ë™
        //marker.setLatLng([lat, lon]);

        // ìƒíƒœëŠ” ì„ì‹œ ëœë¤ (ì›í•œë‹¤ë©´ ì„œë²„ì—ì„œ status ê°™ì´ ë°›ì•„ë„ ë¨)
        //const isMoving = Math.random() > 0.5;

        //if (isMoving) {
        //    marker.setIcon(movingIcon);
        //    marker.bindPopup("ğŸš— ì£¼í–‰ ì¤‘").openPopup();
        //} else {
        //    marker.setIcon(stoppedIcon);
        //    marker.bindPopup("ğŸ›‘ ì •ì§€ ì¤‘").openPopup();
        //}

        //map.panTo([lat, lon]);
        })
        .catch(error => console.error("ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error));
    }

    // 3ì´ˆë§ˆë‹¤ ìƒíƒœ ê°±ì‹ 
    setInterval(updateVehicle, 500);
  </script>
</body>
</html>
