<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>JIAT ê´€ì œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS/JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: sans-serif;
    }

    #map { height: 100vh; width: 50vw;}

    #info {
      flex: 1;
      padding: 16px;
      background: #f4f4f4;
      border-left: 1px solid #ccc;
    }

    #info h2 {
      margin-top: 0;
    }

    .data-row {
      margin: 10px 0;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="info">
    <h2>ì‹¤ì‹œê°„ ì°¨ëŸ‰ ì •ë³´</h2>
    <div class="data-row">ìœ„ë„: <span id="lat">-</span></div>
    <div class="data-row">ê²½ë„: <span id="lng">-</span></div>
    <div class="data-row">ì†ë„: <span id="speed">-</span> km/h</div>
    <div class="data-row">í—¤ë”©: <span id="heading">-</span> Â°</div>
  </div>
  <script>
    // 1. ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map').setView([35.5384, 129.3114], 13); // ìš¸ì‚° ì¤‘ì‹¬ ì¢Œí‘œ ì˜ˆì‹œ

    // 2. ê¸°ë³¸ íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€ (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    // 3. ë§ˆì»¤ ì„ ì–¸ (ì´ˆê¸°ìœ„ì¹˜ ì˜ˆì‹œ)
    let carMarker = L.marker([35.5384, 129.3114]).addTo(map)
      .bindPopup('ë‚´ ì°¨ ìœ„ì¹˜');

    // 4. ì£¼ê¸°ì ìœ¼ë¡œ REST API í˜¸ì¶œí•´ì„œ ìœ„ì¹˜ ê°±ì‹ 
    async function updateCarLocation() {
      try {
        const response = await fetch('http://localhost:5000/pvd'); // ì°¨ëŸ‰ ìœ„ì¹˜ JSON API
        const data = await response.json();
        console.log(data);
        // ì˜ˆì‹œ: { "lat": 35.5423, "lng": 129.3278 }
        const lat = data.lat;
        const lng = data._long;
        const speed = data.speed;
        const heading = data.heading;
        
        // ë§ˆì»¤ ìœ„ì¹˜ ì´ë™
        carMarker.setLatLng([lat, lng]);
        map.panTo([lat, lng]); // ì§€ë„ ì¤‘ì‹¬ ì´ë™ (ì„ íƒ)

        // ğŸ‘‰ ì˜¤ë¥¸ìª½ ì •ë³´ ê°±ì‹ 
        document.getElementById('lat').innerText = lat.toFixed(6);
        document.getElementById('lng').innerText = lng.toFixed(6);
        document.getElementById('speed').innerText = speed.toFixed(1);
        document.getElementById('heading').innerText = heading.toFixed(1);

      } catch (error) {
        console.error('ì°¨ëŸ‰ ìœ„ì¹˜ ê°±ì‹  ì‹¤íŒ¨:', error);
      }
    }

    // 5. ì¼ì • ì£¼ê¸°ë¡œ ê°±ì‹  (ì˜ˆ: 3ì´ˆë§ˆë‹¤)
    setInterval(updateCarLocation, 500);

    // í˜ì´ì§€ ë¡œë“œì‹œ í•œ ë²ˆ ê°±ì‹ 
    updateCarLocation();
  </script>
</body>
</html>